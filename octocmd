#!/usr/bin/env php
<?php
define('CMS_BASE_PATH', dirname(__FILE__) . '/');
define('CMS_PATH', CMS_BASE_PATH . 'Octo/');

if (stripos(CMS_BASE_PATH, 'vendor/block8/octo') !== false) {
    define('APP_PATH', realpath(CMS_BASE_PATH . '../../../') . '/');
} else {
    define('APP_PATH', getcwd() . '/');
}

define('IS_CONSOLE', true);

require_once(CMS_PATH . 'bootstrap.php');

$application = new Symfony\Component\Console\Application();
$items = glob(CMS_PATH.'*/Command/*.php');

foreach ($items as $item) {
    $command = str_replace([CMS_BASE_PATH, '/', '.php'], ['', '\\', ''], $item);
    $application->add(new $command());
}

// Add commands found in the application namespace
foreach (glob(APP_PATH."*", GLOB_ONLYDIR) as $path) {
    $items = glob($path.'/*/Command/*.php');
    foreach ($items as $item) {
        $command = str_replace([APP_PATH, '/', '.php'], ['', '\\', ''], $item);
        $application->add(new $command());
    }
}

$application->run();
